#
# $Id: maui.spec.in,v 1.11 2006/09/07 20:06:50 royd Exp $
#

%define	patch	@PATCH@
%define prefix  /opt/maui

Summary: Maui Scheduler
Name: maui
Version: @VERSION@@PATCH@
Release: @RELEASE@
Vendor: @VENDOR@
License: @VENDOR@, (C) 2000
Group: Applications/Engineering
Source: %{name}-%{version}.tar.gz
#Patch0: maui-double-count-fix.patch
Patch1: maui-3.2.6p19-correct-sprintf.patch
Prefix: %{prefix}
BuildRequires: torque
BuildRoot: /var/tmp/maui-root

%description
This package contains the Maui Scheduler, an advance reservation based HPC 
batch scheduler with extensive job management and resource optimization
features.  This version of Maui requires the Moab Local Scheduling System 
(2.3 or higher) which is also bundled in this distribution.

This software is freely available.  You may copy, distribute, and modify it 
under the terms of the Licenses contained in the files, LICENSE.maui and 
LICENSE.moab, distributed with this package.


##
## PREP
##
%prep

##
## SETUP and PATCH
##
%setup
#%patch1 -p 1
# larger values than default are needed for large clusters.
#sed -i '/MMAX_JOB/ s/4096/8192/g' ./include/msched.h
#sed -i '/MAX_MRES/ s/1024/8192/g' ./include/moab.h

##
## BUILD
##
%build
#make sure pbs-config is in the path so configure picks up the right setup.
export PATH=$PATH:/opt/torque/bin
./configure --prefix=%{prefix} --with-machine=rocks.dummy.host --with-spooldir=%{prefix} \
		  --with-key=0

sed -i "/PBSLDFLAGS/ s|-ltorque|-L$(pbs-config --libdir) $(pbs-config --libs)|" Makefile
make 
#
##
## INSTALL
##
%install

%makeinstall BUILDROOT=$RPM_BUILD_ROOT



##
## FILES
##
%files
%attr(755,maui,maui) %{prefix}
%config %{prefix}/maui.cfg 
%config %{prefix}/maui-private.cfg

%doc  CHANGELOG LICENSE README docs/mauidocs.html


##
## CLEAN
##
%clean
rm -rf $RPM_BUILD_ROOT

